from pydantic import BaseModel
from typing import Optional, List
from datetime import datetime

class ServerCreate(BaseModel):
    name: str
    version: str
    ram_mb: int
    port: int
    online_mode: bool = False
    mod_loader: Optional[str] = "vanilla"
    cpu_cores: Optional[float] = 2.0
    disk_mb: Optional[int] = 10000
    max_players: Optional[int] = 20
    motd: Optional[str] = "A Minecraft Server"

class ServerUpdate(BaseModel):
    version: Optional[str]
    ram_mb: Optional[int]
    port: Optional[int]
    online_mode: Optional[bool]
    mod_loader: Optional[str]
    cpu_cores: Optional[float]
    disk_mb: Optional[int]
    max_players: Optional[int]
    motd: Optional[str]

class ServerResponse(ServerCreate):
    id: int
    status: str
    created_at: Optional[datetime]
    # Runtime metrics (from model - injected by controller from process stats)
    cpu_usage: Optional[float] = 0.0
    ram_usage: Optional[int] = 0  # Match model field name
    current_players: Optional[int] = 0  # Match model field name
    disk_usage: Optional[int] = 0
    
    class Config:
        orm_mode = True

class ServerStats(BaseModel):
    status: str
    cpu: float
    ram: float

class Token(BaseModel):
    access_token: str
    token_type: str

class UserLogin(BaseModel):
    username: str
    password: str

class ModSearchConnect(BaseModel):
    query: str
    version: str

class RegisterRequest(BaseModel):
    username: str
    password: str

class SystemInfo(BaseModel):
    os: str
    cpu_count: int
    cpu_percent: float
    ram_total_mb: int
    ram_used_mb: int
    ram_available_mb: int
    disk_total_mb: int
    disk_used_mb: int
    disk_available_mb: int

class BitacoraEntry(BaseModel):
    id: int
    timestamp: datetime
    username: str
    action: str
    ip_address: Optional[str]
    details: Optional[str]
    severity: Optional[str]

    class Config:
        orm_mode = True

class VersionResponse(BaseModel):
    id: int
    name: Optional[str]
    loader_type: str
    mc_version: str
    loader_version: Optional[str]
    local_path: Optional[str]
    downloaded: bool

    class Config:
        orm_mode = True

class WorldCreate(BaseModel):
    name: str
    seed: Optional[str] = None
    original_version: Optional[str] = None

class WorldResponse(BaseModel):
    id: int
    name: str
    seed: Optional[str]
    original_version: Optional[str]
    last_used_version: Optional[str]
    size_mb: Optional[int]
    created_at: datetime
    
    class Config:
        orm_mode = True

class WorldAssignRequest(BaseModel):
    server_ids: List[int]
